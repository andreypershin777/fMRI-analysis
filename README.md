В данным репозитории представлена программная реализация метода анализа воспроизводимости мозговых ответом по данным фМРТ эксперимента. Метода предназначен для применения на фМРТ данных экперимента одного испытуемого с несколькими экспериментальными сессиями и несколькими типами выполняемых задач. Метод применялся на данных с 6 экспериментальными сессиями на испытуемого, по 3 на каждый из типов задач. Предполагается, что число экспериментальных сессий >=4, и чем больше, тем лучше.

Реализация состоит из 3 файлов .py:

'diploma_functions.py' - функции, необходимые для выполнения каждого шага анализа воспроизводимости

'diploma_script.py' - программа для расчета карты активности мозга по данным фМРТ

'show_results.py' - визуализация результатов, выделение воспроизводимых вокселей на анатомическом скане

###Параметры запуска

На данный момент программа адаптирована для данных конкретного фМРТ эксперимента по саморефенции (пример папки с данными есть в репозитории), но легко может быть переписана для новых данных.

####'diploma_functions.py':

Файл с функциями

####'diploma_script.py':

'patient_data_path' - путь до папки с данными эксперимента. В ней папка с логами, папка со структурным сканов, по одной папке для каждой экспериментальной сессии

'save_path' - путь до папки, в которой требуется сохранять результаты. В этой папке создастся новая папка 'Запуск_{i}', (i-минимальный номер, папки с которым еще нет) в которую будут сохраняться результаты

'nX' - количество вокселей по оси Ox

'nY' - количество вокселей по оси Oy

'nZ' - количество вокселей по оси Oz

'nT' - количество сканов в одной сессии

'nS' - число предъявляемых стимулов в одной сессии

'nR' - число экспериментальных сессий

'X2' - матрица эффектов типов задач, см. в статье

'K_list' - список чисел генерируемых порогов

####'show_results.py':

'path_to_folder' - путь до папки 'Запуск_{i}', в которой лежат результаты

###Выходные данные

####'diploma_functions.py':

Файл с функциями

####'diploma_script.py':

'output.txt' - файл, содержащий вывод в консоль во время работы программы. В нем находятся промежуточные результаты и время работы программы.

'parameters_{contrast}_{way}.json' - файл, содержащий параметры запуска программы. contrast - расчетный контраст, для которого строилась карта активности, way - вариант оптимизации функции правдоподобия. way=lambda означает, что lambda фиксирован, way=other, что lambda оптимизируется.

'reproducibility_array_{contrast}_{way}_{K}.npy' - numpy.array, содержащий средние t-значения для воспроизводимых вокселей и 0 для невоспроизводимых. K - число порогов, для которого производились расчеты.

'ROC_{contrast}_{way}_{K}.png' - ROC-кривая, точки, по которым она построена, а также рабочая точка на кривой.

####'show_results.py':

Запускается бесконечный цикл для каждого файла .npy, в котором ожидается ввод с клавиатуры. Из соответствующего файла с параметрами извлекается путь до папки со сканами и загружается анатомический скан. При вводе 'end' цикл заканчивается текущего файла и запускается для следующего. При вводе координаты среза вида 'x=10', 'y=12' или 'z=5' файл выведет соответствующий срез анатомического скана (при разных размерах анатомического и функционального выведется ближайший срез), поверх среза анатомического скана будут выделены воспроизводимые воксели. Зеленый/желтый цвет вокселей означает, что соответствующий им средний t-значения отрицательны/положительны, интенсивность цвета отвечает за модуль среднего t-значения.
